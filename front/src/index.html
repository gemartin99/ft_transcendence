<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>CRAZY PONG</title>
	<!-- <link rel="stylesheet" href="/css/styles.css"> -->
	<link rel="stylesheet" href="/css/gstyles.css">
	<link rel="stylesheet" href="/css/gstyles2.css">
	<link rel="stylesheet" href="/css/game.css">
	<link rel="stylesheet" href="/css/login.css">
	<link rel="stylesheet" href="/css/aboutus.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
	<!-- Bootstrap CSS Link -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>

<body class="bg-secondary">
	<!-- HEADER -->
	<nav class="navbar navbar-expand-md navbar-dark bg-dark">
		<div class="container-fluid">
			<!-- icono y nombre -->
			<a class="navlink navbar-brand" href="/">
				<i class="fa-solid fa-table-tennis-paddle-ball" style="color: #f5c344;"></i>
				<span class="text-warning">CrazyPong</span>
			</a>  
			<!-- boton del menu -->
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#menu" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<!-- elementos del menu colapsable -->
			<div class="collapse navbar-collapse" id="menu">
				<ul class="navbar-nav me-auto">
					<li class="nav-item"><a class="navlink nav-link active" aria-current="page" href="/">Home</a></li>
					<li class="nav-item"><a class="navlink li nav-link" href="/game">Game</a></li>
					<li class="nav-item"><a class="navlink li nav-link" href="/tournament">Tournament</a></li>
					<li class="nav-item"><a class="navlink li nav-link" href="/users">Friends</a></li>
					<li class="nav-item"><a class="navlink nav-link" href="/information">Information</a></li>
					<li class="nav-item"><a class="navlink nav-link" href="/about-us">About us</a></li>
				</ul>
				<hr class="d-md-none text-white-50">
				<!-- enlaces redes sociales -->
				<ul class="navbar-nav  flex-row flex-wrap text-light">
					<li class="nav-item col-6 col-md-auto p-3">
						<a href="https://www.github.com/gemartin99/ft_transcendence" target="_blank" class="text-light text-decoration-none">
						<i class="fab fa-github fs-5"></i>
						<small class="d-md-none ms-2">GitHub</small>
						</a> 
					</li>
					<li class="nav-item col-6 col-md-auto p-3">
						<a href="https://www.instagram.com/crazypong" target="_blank" class="text-light text-decoration-none">
						<i class="fab fa-instagram fs-5"></i>
						<small class="d-md-none ms-2">Instagram</small>
						</a>
					</li>
					<!-- ... (otros elementos del menÃº) ... -->
				</ul>
				<hr class="d-md-none text-white-50">
				<!--boton Cuenta -->

				<a href="/users/profile" class="navlink li btn btn-sm btn-outline-warning d-md-inline-block">Profile</a>
				<a href="/users/logout" class="navlink li btn btn-sm btn-outline-warning d-md-inline-block" onclick="set_logged_out_view()">Logout</a>
				<a href="/users/register" class="navlink lo btn btn-sm btn-warning d-md-inline-block" >Register</a>
				<a href="/users/login" class="navlink lo btn btn-sm btn-warning d-md-inline-block" >Login</a>
			</div>
		</div>  
	</nav>
	<!-- END HEADER -->
	<!-- CONTENT -->
	<div id="content">
		<section class="section pb-0">
			<div class="container">
				<div class="row justify-content-between align-items-center">
					<div class="col-7">
						<h1 class="mb-4">Welcome to my final project for 42 school</h1>
						<p class="mb-4">"Crazy Pong is a tribute to the classic Atari Pong game, This version takes the
							original gameplay and adds a twist with new features such as power-ups, obstacles, and multiple
							levels. The user interface has also been updated for a modern look and feel. Whether you're a
							fan of the original Pong or just looking for a fun and challenging game, Crazy Pong is sure to
							provide hours of entertainment. Try it out now and see if you have what it takes to beat the high
							score!"</p>
					</div>
					<div class="col-4 d-none d-md-block">
						<img src="/imgs/Pong.jpeg" alt="illustration" class="img-fluid">
					</div>
				</div>
			</div>
		</section>
	</div>
	<!-- END CONTENT -->
	<!-- FOOTER -->
    <footer class="footer fixed-bottom bg-dark text-white text-center">
		<div class="container">
            <button  id="showonline">ShowOnlineUsers</button>

			<script>
			  const showonline = document.getElementById('showonline');

			  showonline.addEventListener('click', function() {
			    console.log('Trying to print online users.');

			    fetch("http://localhost:8000/users/showonline/", {
			    	credentials: 'include',
			    })
			      .then(response => response.json())
			      .then(data => {
			        console.log('Response from backend:', data);
			        const username = document.cookie.split('; ').find(row => row.startsWith('jwttoken=')).split('=')[1];
					console.log(username);

			        if (data.content) {
			          console.log(data.content);
			        } else {
			          console.log('Invalid response from backend');
			        }
			      })
			      .catch(error => {
			        console.error('Error:', error);
			      });
			  });
			</script>


			<script>
		        document.addEventListener('keydown', function(event) {
		            if (event.key === 'ArrowLeft' && !event.ctrlKey && !event.shiftKey && !event.altKey) {
		                // Handle left arrow key press (previous page)
		                goPrevPage();
		            } else if (event.key === 'ArrowRight' && !event.ctrlKey && !event.shiftKey && !event.altKey) {
		                // Handle right arrow key press (next page)
		                goNextPage();
		            }
		        });

		        function goPrevPage() {
		            // Get the href value of the previous link and navigate to it
		            const prevLink = document.querySelector('a[rel=prev]');
		            if (prevLink) {
		                window.location.href = prevLink.href;
		            }
		        }

		        function goNextPage() {
		            // Get the href value of the next link and navigate to it
		            const nextLink = document.querySelector('a[rel=next]');
		            if (nextLink) {
		                window.location.href = nextLink.href;
		            }
		        }
		    </script>

		    <script>
		        // Function to get the value of a URL parameter
		        function getParameterByName(name, url) {
		            if (!url) url = window.location.href;
		            name = name.replace(/[[]]/g, "\\$&");
		            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
		                results = regex.exec(url);
		            if (!results) return null;
		            if (!results[2]) return '';
		            return decodeURIComponent(results[2].replace(/\+/g, " "));
		        }

		        // Check if the URL contains the "?code=" parameter
		        var codeValue = getParameterByName('code');

		        if (codeValue !== null) {
		            console.log('Code value:', codeValue);

		            // Construct the formDataObject
		            var formDataObject = {
		                code: codeValue
		                // Add other parameters if needed
		            };

		            // Fetch to the backend
		            fetch('http://localhost:8000/FT_OAuth/42/', {
		                method: 'POST',
		                headers: {
		                    'Content-Type': 'application/json',
		                },
		                credentials: 'include',
		                body: JSON.stringify(formDataObject),
		            })
		            .then(response => response.json())
		            .then(data => {
		                console.log('Response:', data.message);
		                console.log('jwttoken:', data.jwtToken)
				        const expirationDate = new Date();
				        expirationDate.setTime(expirationDate.getTime() + (23 * 60 * 60 * 1000));

				        if (data.jwtToken)
				            document.cookie = `jwttoken=${data.jwtToken}; Secure; expires=${expirationDate}; SameSite=None; path=/;`;
				        console.log('jwttoken:', data.jwtToken);


				        if (getCookie('jwttoken')) {
				            set_logged_in_view();
				            history.pushState(null, null, '/');
				            handleNavLinkAction('/');
				            const socket = new WebSocket('ws://'+ url +':8000/ws/login/?user=' + data.user);
				        }
				        else {
				            set_logged_out_view();
				        }

		            })
		            .catch((error) => {
		                console.error('Error:', error);
		                // Handle error
		            });
		        } else {
		            console.log('No code parameter found in the URL.');
		        }
		    </script>

			<p>&copy; 2023 CrazyPong. All rights reserved.</p>
			<button onclick="set_logged_in_view()">test login</button>
		</div>
 	
	  <h2>Enable Two-Factor Authentication</h2>
	    <button id="getQR"  onclick="getQR()">getQR</button>
	    <p>Scan the QR code below using the Google Authenticator app:</p>
	    <canvas id="QRimg"></canvas>
	    <!-- <img id ="QRimg" alt="QR Code"> -->
	    <p>Or enter the following key manually: {{ request.user.totp_secret }}</p>
		<form id="textForm" onsubmit="checkAuthCode(event)">
		    <label for="textInput">Enter Text:</label>
		    <input type="text" id="textInput" name="text" required>
		    <button type="submit">check code</button>
		</form>
		<div>
	        <!-- Container to display response from the backend -->
	        <p id="responseMessage"></p>
	    </div>
	    
 	</footer>
	<!-- END FOOTER -->
	<script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
	<script src="/js/navigation.js"></script>
	<script src="/js/game.js"></script>
	<script src="/js/accounts.js"></script>
	<script src="/js/validations.js"></script>
	<script src="/js/twoFA.js"></script>
	<script src="/js/session.js"></script>
</html>


